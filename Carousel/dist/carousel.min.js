var Carousel=function($){"use strict";var _left=0,_top=0,_touchstart_time=null,_touches={startX:0,startY:0,currentX:0,currentY:0,diff:0},_current_slide_index=0,_current_slide_index_temp=0,_dxrad=.1,_setPosition=function(a,b,c){var d=c.a*Math.sin(b)+_left,e=c.b*Math.cos(b)+_top,f=1-.25*(1-Math.cos(b));a.style.webkitTransform="translate3d("+d+"px, "+e+"px, 1px) scale("+f+")",a.style.zIndex=Math.cos(b)>0?3:2},Carousel=function(a,b){var c=$(a),d=b||{};return new Carousel.prototype.init(c,d)};return Carousel.prototype={constructor:Carousel,init:function(el,opt){this.el=el,this.uid="move_"+Math.random(),this.uid=this.uid.replace(".",""),eval("window."+this.uid+"=this;"),this.config={a:100,b:60},this.config=$.extend(this.config,opt||{}),this.items=[],_left=(this.el.width()-this.el.find(".carousel-slide").width())/2,_top=.5*this.config.b;var images=this.el.find(".carousel-slide");images.eq(0).addClass("current-slide");for(var n=images.length,i=0;n>i;i++)this.items=images,_setPosition(images[i],2*Math.PI*i/n,this.config);this.onTouchStart(),this.onTouchMove(),this.onTouchEnd();var that=this;that.el.on("click",".carousel-slide",function(){if(that.config.slideClick){var a=$(this).index();that.config.slideClick(a,this)}})},transition:function(a,b,c){var d=this;console.log("---transition----"+_current_slide_index);for(var e=!0,f=0;a>f;f++)_setPosition(this.items[f],2*Math.PI*(f-_current_slide_index)/a+_dxrad,d.config);if(c>0?(_dxrad+=.03,_dxrad>=b&&(_dxrad=b,e=!1)):(_dxrad-=.03,Math.abs(_dxrad)>=b&&(_dxrad=b,e=!1)),e)setTimeout(this.uid+".transition("+a+", "+b+","+c+")",1e3/60/10);else{_dxrad=.1,_current_slide_index=0>c?_current_slide_index+1>=a?0:_current_slide_index+1:0>_current_slide_index-1?a:_current_slide_index-1;for(var f=0;a>f;f++){var g=d.items[f];_setPosition(g,2*Math.PI*(f-_current_slide_index)/a,d.config)}d.el.find(".carousel-slide").removeClass("current-slide"),d.el.find(".carousel-slide:nth-child("+(_current_slide_index+1)+")").addClass("current-slide"),d.config.onTransitionEnd&&d.config.onTransitionEnd(_current_slide_index,$(".current-slide")[0],d)}},onTouchStart:function(){var a=this;a.el.on("touchstart",function(b){_touchstart_time=new Date,b.originalEvent&&(b=b.originalEvent),_touches.startX=_touches.currentX="touchstart"===b.type?b.targetTouches[0].pageX:b.pageX,_touches.startY=_touches.currentY="touchstart"===b.type?b.targetTouches[0].pageY:b.pageY,a.config.onTouchStart&&a.config.onTouchStart(_current_slide_index,a)})},onTouchMove:function(){var a=this;a.el.on("touchmove",function(b){if(b.preventDefault&&b.preventDefault(),b.originalEvent&&(b=b.originalEvent),!(b.targetTouches&&b.targetTouches.length>1)){_touches.currentX="touchmove"===b.type?b.targetTouches[0].pageX:b.pageX;var c=_touches.diff=_touches.currentX-_touches.startX,d=$(window).width();a.direction=c>0?"prev":"next";var e=c/d;if(!(Math.abs(c)<30)){_dxrad=Math.PI*e,a.el.find(".carousel-slide").css({webkitTransitionDuration:"0ms"});for(var f=a.items.length,g="",h=-2,i=0;i<a.items.length;i++){var j=a.items[i],k=2*Math.PI*(i-_current_slide_index)/f+_dxrad;_setPosition(j,k,a.config);var l=Math.cos(k);3==j.style.zIndex&&l>h&&(h=l,g=j,_current_slide_index_temp=i)}a.el.find(".carousel-slide").removeClass("current-slide"),$(g).addClass("current-slide"),a.config.onTouchMove&&a.config.onTouchMove(_current_slide_index_temp,a)}}})},onTouchEnd:function(){var a=this;a.el.on("touchend",function(){var b=a.items.length,c=new Date;if(_current_slide_index_temp>=0&&(_current_slide_index=_current_slide_index_temp,_current_slide_index_temp=-1),200>c-_touchstart_time&&Math.abs(_touches.diff)>50)a.transition(b,2*Math.PI/b,_touches.diff);else{a.el.find(".carousel-slide").css({webkitTransitionDuration:"120ms"});for(var d=0;b>d;d++){var e=a.items[d];_setPosition(e,2*Math.PI*(d-_current_slide_index)/b,a.config)}a.config.onTransitionEnd&&a.config.onTransitionEnd(_current_slide_index,$(".current-slide")[0],a)}_touches.diff=0})},slideTo:function(a){var b=this,c=b.items.length;_current_slide_index=a;for(var d=0;c>d;d++){var e=b.items[d];_setPosition(e,2*Math.PI*(d-_current_slide_index)/c,b.config)}},next:function(){var a=_current_slide_index+1>=this.items.length?0:_current_slide_index+1;this.slideTo(a)},prev:function(){var a=0>_current_slide_index-1?this.items.length:_current_slide_index-1;this.slideTo(a)}},Carousel.prototype.init.prototype=Carousel.prototype,Carousel}(window.jQuery||window.Zepto||window.$||{});"undefined"!=typeof module?module.exports=Carousel:"function"==typeof define&&define.amd&&define([],function(){"use strict";return Carousel});