var Carousel=function(a){"use strict";var b=0,c=0,d=null,e={startX:0,startY:0,currentX:0,currentY:0,diff:0},f=0,g=0,h=.1,i=function(a,d,e){var f=e.a*Math.sin(d)+b,g=e.b*Math.cos(d)+c,h=1-.25*(1-Math.cos(d));a.style.webkitTransform="translate3d("+f+"px, "+g+"px, 1px) scale("+h+")",a.style.zIndex=Math.cos(d)>0?3:2},j=function(a,b,c,d){var e=a.length;console.log("---transition----"+f);for(var g=!0,k=0;e>k;k++)i(a[k],2*Math.PI*(k-f)/e+h,d);if(c>0?(h+=.03,h>=b&&(h=b,g=!1)):(h-=.03,Math.abs(h)>=b&&(h=b,g=!1)),g)setTimeout(function(){j(a,b,c,d)},1e3/60/10);else{h=.1,f=0>c?f+1>=e?0:f+1:0>f-1?e:f-1;for(var k=0;e>k;k++){var l=a[k];i(l,2*Math.PI*(k-f)/e,d)}}},k=function(b,c){var d=a(b),e=c||{};return new k.prototype.init(d,e)};return k.prototype={constructor:k,init:function(d,e){this.el=d,this.config={a:100,b:60},this.config=a.extend(this.config,e||{}),this.items=[],b=(this.el.width()-this.el.find(".carousel-slide").width())/2,c=.5*this.config.b;var f=this.el.find(".carousel-slide");f.eq(0).addClass("current-slide");for(var g=f.length,h=0;g>h;h++)this.items=f,i(f[h],2*Math.PI*h/g,this.config);this.onTouchStart(),this.onTouchMove(),this.onTouchEnd();var j=this;j.el.on("click",".carousel-slide",function(){if(j.config.slideClick){var b=a(this).index();j.config.slideClick(b,this)}})},onTouchStart:function(){var a=this;a.el.on("touchstart",function(b){d=new Date,b.originalEvent&&(b=b.originalEvent),e.startX=e.currentX="touchstart"===b.type?b.targetTouches[0].pageX:b.pageX,e.startY=e.currentY="touchstart"===b.type?b.targetTouches[0].pageY:b.pageY,a.config.onTouchStart&&a.config.onTouchStart(f,a)})},onTouchMove:function(){var b=this;b.el.on("touchmove",function(c){if(c.preventDefault&&c.preventDefault(),c.originalEvent&&(c=c.originalEvent),!(c.targetTouches&&c.targetTouches.length>1)){e.currentX="touchmove"===c.type?c.targetTouches[0].pageX:c.pageX;var d=e.diff=e.currentX-e.startX,j=a(window).width();b.direction=d>0?"prev":"next";var k=d/j;if(!(Math.abs(d)<30)){h=Math.PI*k,b.el.find(".carousel-slide").css({webkitTransitionDuration:"0ms"});for(var l=b.items.length,m="",n=-2,o=0;o<b.items.length;o++){var p=b.items[o],q=2*Math.PI*(o-f)/l+h;i(p,q,b.config);var r=Math.cos(q);3==p.style.zIndex&&r>n&&(n=r,m=p,g=o)}b.el.find(".carousel-slide").removeClass("current-slide"),a(m).addClass("current-slide"),b.config.onTouchMove&&b.config.onTouchMove(g,b)}}})},onTouchEnd:function(){var b=this;b.el.on("touchend",function(){var c=b.items.length,h=new Date;if(g>=0&&(f=g,g=-1),200>h-d&&Math.abs(e.diff)>50)j(b.items,2*Math.PI/c,e.diff,b.config);else{b.el.find(".carousel-slide").css({webkitTransitionDuration:"120ms"});for(var k=0;c>k;k++){var l=b.items[k];i(l,2*Math.PI*(k-f)/c,b.config)}b.config.onTransitionEnd&&b.config.onTransitionEnd(f,a(".current-slide")[0],b)}e.diff=0})},slideTo:function(a){var b=this,c=b.items.length;f=a;for(var d=0;c>d;d++){var e=b.items[d];i(e,2*Math.PI*(d-f)/c,b.config)}},next:function(){var a=f+1>=this.items.length?0:f+1;this.slideTo(a)},prev:function(){var a=0>f-1?this.items.length:f-1;this.slideTo(a)}},k.prototype.init.prototype=k.prototype,k}(window.jQuery||window.Zepto||window.$||{});"undefined"!=typeof module?module.exports=Carousel:"function"==typeof define&&define.amd&&define([],function(){"use strict";return Carousel});